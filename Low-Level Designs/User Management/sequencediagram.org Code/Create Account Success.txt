title User Management Success Scenario - Create Account

#participant "System Administrator" as admin
participant "Command Line" as cmd
participant "Main : umEntry" as entry
participant "umManager : umManager" as manager
participant "umService : umService" as service
participant "umDAO : MSSQLUMGateway" as umDAO
participant "SQL Server" as umStore
participant "umLogger : LogWriter" as logger
participant "umAuthentication : Authentication" as authN
participant "umAuthorization : Authorization" as authZ

activate cmd

cmd->entry : User has selected "Create Account"
activate entry
entry->entry : Validate input (request : int)

entry->manager : manager = new umManager(userID : String)

activate manager
manager->authN : umAuthentication = new Authentication()
activate authN
authN->authN : Constructor
authN-->manager : return umAuthentication
deactivate authN

manager->authZ : new umAuthorization(umAuthentication : Authentication, userID : String)
activate authZ
authZ->authZ : Constructor
authZ-->manager : return umAuthentication

authZ->authN : AuthenticateUser(userID : String)
activate authN
authN->authZ : True : Boolean
deactivate authN

authZ->authZ : AuthorizeUser(userID : String)
authZ-->manager : True : Boolean
deactivate authZ

manager-->entry : return manager
deactivate manager

entry->logger : umLogger = new LogWriter()
activate logger
logger->logger : Constructor
logger-->entry : return umLogger
deactivate logger

entry->umDAO : dao = new umDAO()
activate umDAO
umDAO->umDAO : Constructor
umDAO-->entry : return dao
deactivate umDAO

entry->service : service = new umService(dao : umDAO) 
activate service
service->service : Constructor
service-->entry : return service
deactivate service

entry->service : umService.CreateAccount(userName : String, email : String, password : String)
activate service
service->umDAO : umDAO.WriteToDataStore(userName : String, email : String, password : String)
activate umDAO
umDAO->umDAO : String query = $"INSERT INTO users (userName, email, password)\n    VALUES ({userName}, {email}, {password})"
umDAO->umStore : INSERT into users VALUES (userName, email, password)
activate umStore
umStore->umStore : Insert values into table
umStore-->umDAO : 1 : int
deactivate umStore


umDAO-->service : True : Boolean
deactivate umDAO

service-->entry : True : Boolean
deactivate service
note left of entry:The response should occur within 5 seconds of invocation.
note left of entry:<size:20>â†“
entry-->cmd : Single UM Operation Successful

entry-->logger : umLogger.Write(userID : int, logLevel : enum, category : enum, message : String)
activate logger
logger->logger : Refer to the Logging Sequence Diagram
logger-->entry : True : Boolean
deactivate logger

deactivate cmd

# NOTES: 
#	- Implement AUTHN & AUTHZ
#	- Layer names correct?