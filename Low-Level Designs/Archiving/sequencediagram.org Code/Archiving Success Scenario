title Archiving Success Scenario

participant "mainControl : MainController" as control
participant "archivingService : ArchivingService" as service
participant "logGateway : SQLLogGateway" as reader
participant "SQL Server" as logs
participant "archiveGateway : CompressingFileSystemLogGateway" as writer
participant "Web Host File System" as archive

#Instantiations (Dependency injection)
activate control
control->*reader:new SQLLogGateway(String serverConnectionString)
activate reader
reader->reader:Constructor
reader-->control:SQLLogGateway instance
deactivate reader
control->*writer:new CompressingFileSystemLogGateway(String fileLocation)
activate writer
writer->writer:Constructor
writer-->control:CompressingFileSystemLogGateway instance
deactivate writer
control->*service:new ArchivingService(logGateway : ILogGateway, archiveGateway : ILogGateway)
activate service
service->service:Constructor
service-->control:ArchivingService instance
deactivate service
#Methods Begin
control->>control:waitForArchive()
note over control:waitForArchive() waits until 00:00:00 AM local time\non the first of the month then calls the next method. 
control->service:archivingService.archiveData(minimumAge : int, tableName : String)
activate service
service->reader:logGateway.readLogsWhere(columnName : String, comparator : Enum, value : String)
activate reader
reader->logs:SELECT statement
activate logs
logs-->reader:Selected rows
deactivate logs
reader-->service:logs : DataSet
deactivate reader
service->reader:logGateway.deleteLogsWhere(columnName : String, comparator : Enum, value : String)
activate reader
reader->logs:DELETE statement
activate logs
logs-->reader:X : int
deactivate logs
reader-->service:true : boolean
service->writer:archiveGateway.writeLogs(logs : DataSet)
activate writer
writer->archive:new .zip file
activate archive
archive-->writer:
deactivate archive
writer-->service:true
deactivate writer
service-->control:true
control->>control:waitForArchive()
deactivate service


# UNSURE:
# How to compress files?
# SQL Server has a BACKUP command. Should use?
# How to add new entries to a SQL backup file?
# 	Can we save multiple backups and restore differentially a la git?
# Need to specify that the sequence is occurring at midnight of the first of the month/ whatever time?
# How to specify fitting performance NFR and other NFRs?
