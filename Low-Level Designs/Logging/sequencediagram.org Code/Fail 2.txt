title Logging Fail - User Blocked

participant "mainControl : Control" as control
participant "logWriter : LogWriter" as writer
participant "logGateway : SQLLogGateway" as dao
participant "SQL Server" as db

note over db:The data store is online, accessible to the system,\nand has storage capacity for a log entry.\nNo users can call an UPDATE statement\nover the table containing the entry being inserted.
#instantiation/constructors
activate control
control->*dao:new SQLLogGateway()
activate dao
dao->dao:Constructor
dao-->control:SQLLogGateway instance
deactivate dao
control->*writer:new LogWriter(logConnection : LogGateway)
activate writer
writer->writer:Constructor
writer-->control:LogWriter instance
deactivate writer
#functionality method calls
control->writer: logWriter.write(userID : int, logLevel : enum, category : enum, message : String)
activate writer
note over writer: System-initiated logs have a userID 0.\nUser-initiated logs have a userID equal to the initiating user's ID.
writer->dao:logConnection.writeLogs(userID : int, level : enum, category : enum, message : string)
activate dao
#inbound request to show that the log writing is asynchronous
[-xcontrol:request
#SQL statement detailed enough? too detailed?
dao->db:INSERT INTO tablename VALUES (userID, timedate, level, category, message)\n    OUTPUT INSERTED.*
activate db
db-->dao:Inserted row
deactivate db
dao-->writer: 1 : int
deactivate dao
writer-->control: true : boolean
deactivate writer
deactivate control
