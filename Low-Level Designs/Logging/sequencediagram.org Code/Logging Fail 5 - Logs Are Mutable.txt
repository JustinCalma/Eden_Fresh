title Logging Fail - Logs Are Mutable

participant "logWriter : LogWriter" as writer
participant "logGateway : MSSQLLogGateway" as dao
participant "SQL Server" as db

note right of db:Previously saved log entries are modifiable now.
#instantiation/constructors
[->dao:new SQLLogGateway()
activate dao
dao->dao:Constructor
dao-->[:SQLLogGateway instance
deactivate dao
[->writer:new LogWriter(logConnection : LogGateway)
activate writer
writer->writer:Constructor
writer-->[:LogWriter instance
deactivate writer
#functionality method calls
[-->writer: logWriter.write(username : String, logLevel : enum, category : enum, message : String)
activate writer
note left of writer: System-initiated logs have a username "SYSTEM".\nUser-initiated logs have a username equal to the initiating user's.
writer->writer:Get current timestamp
writer->dao:logConnection.writeLogs(username : String, timeDate : String, level : enum, category : enum, message : string)
activate dao
dao->dao:Build SQL query from writeLogs() args; sanitize message for SQL insertion.
#inbound request to show that the log writing is asynchronous
#SQL statement detailed enough? too detailed?
dao->db:INSERT INTO tablename VALUES (username, timedate, level, category, message)\n    OUTPUT INSERTED.*
activate db
db->db:Insert values into table
db-->dao:Inserted row
deactivate db
dao->dao:Validate inserted values with writeLogs args
dao-->writer: true : boolean
deactivate dao
note left of writer:The response should occur within 5 seconds of invocation.
writer-->[: true : boolean
deactivate writer
